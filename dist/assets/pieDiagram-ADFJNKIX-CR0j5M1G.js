import{ab as t,a3 as e,aG as a,C as n,n as i,o as r,s as l,g as s,c as o,b as p,_ as c,l as u,t as d,d as f,D as g,H as h,P as m,k as x}from"./index-Bw4ovaN-.js";import{p as y}from"./chunk-4BX2VUAB-jau5tPgO.js";import{p as w}from"./treemap-75Q7IDZK-mCZ4YnMu.js";import{d as v}from"./arc-BJMmLFWa.js";import{o as S}from"./ordinal-CVjKTKEW.js";import"./ui-BWhiaM1c.js";import"./vendor-D7xkEKTB.js";import"./utils-JriQOhk-.js";import"./router-CuiZoW9L.js";import"./_baseUniq-O2dbLT9q.js";import"./_basePickBy-BIoHT--R.js";import"./clone-5rcsNxeZ.js";import"./init-C0SZ43gy.js";function b(t,e){return e<t?-1:e>t?1:e>=t?0:NaN}function $(t){return t}var A=n.pie,D={sections:new Map,showData:!1,config:A},T=D.sections,C=D.showData,j=structuredClone(A),k={getConfig:c(()=>structuredClone(j),"getConfig"),clear:c(()=>{T=new Map,C=D.showData,d()},"clear"),setDiagramTitle:i,getDiagramTitle:r,setAccTitle:l,getAccTitle:s,setAccDescription:o,getAccDescription:p,addSection:c(({label:t,value:e})=>{if(e<0)throw new Error(`"${t}" has invalid value: ${e}. Negative values are not allowed in pie charts. All slice values must be >= 0.`);T.has(t)||(T.set(t,e),u.debug(`added new section: ${t}, with value: ${e}`))},"addSection"),getSections:c(()=>T,"getSections"),setShowData:c(t=>{C=t},"setShowData"),getShowData:c(()=>C,"getShowData")},M=c((t,e)=>{y(t,e),e.setShowData(t.showData),t.sections.map(e.addSection)},"populateDb"),z={parse:c(async t=>{const e=await w("pie",t);u.debug(e),M(e,k)},"parse")},B=c(t=>`\n  .pieCircle{\n    stroke: ${t.pieStrokeColor};\n    stroke-width : ${t.pieStrokeWidth};\n    opacity : ${t.pieOpacity};\n  }\n  .pieOuterCircle{\n    stroke: ${t.pieOuterStrokeColor};\n    stroke-width: ${t.pieOuterStrokeWidth};\n    fill: none;\n  }\n  .pieTitleText {\n    text-anchor: middle;\n    font-size: ${t.pieTitleTextSize};\n    fill: ${t.pieTitleTextColor};\n    font-family: ${t.fontFamily};\n  }\n  .slice {\n    font-family: ${t.fontFamily};\n    fill: ${t.pieSectionTextColor};\n    font-size:${t.pieSectionTextSize};\n    // fill: white;\n  }\n  .legend text {\n    fill: ${t.pieLegendTextColor};\n    font-family: ${t.fontFamily};\n    font-size: ${t.pieLegendTextSize};\n  }\n`,"getStyles"),O=c(n=>{const i=[...n.values()].reduce((t,e)=>t+e,0),r=[...n.entries()].map(([t,e])=>({label:t,value:e})).filter(t=>t.value/i*100>=1).sort((t,e)=>e.value-t.value),l=function(){var n=$,i=b,r=null,l=t(0),s=t(e),o=t(0);function p(t){var p,c,u,d,f,g=(t=a(t)).length,h=0,m=new Array(g),x=new Array(g),y=+l.apply(this,arguments),w=Math.min(e,Math.max(-e,s.apply(this,arguments)-y)),v=Math.min(Math.abs(w)/g,o.apply(this,arguments)),S=v*(w<0?-1:1);for(p=0;p<g;++p)(f=x[m[p]=p]=+n(t[p],p,t))>0&&(h+=f);for(null!=i?m.sort(function(t,e){return i(x[t],x[e])}):null!=r&&m.sort(function(e,a){return r(t[e],t[a])}),p=0,u=h?(w-g*S)/h:0;p<g;++p,y=d)c=m[p],d=y+((f=x[c])>0?f*u:0)+S,x[c]={data:t[c],index:p,value:f,startAngle:y,endAngle:d,padAngle:v};return x}return p.value=function(e){return arguments.length?(n="function"==typeof e?e:t(+e),p):n},p.sortValues=function(t){return arguments.length?(i=t,r=null,p):i},p.sort=function(t){return arguments.length?(r=t,i=null,p):r},p.startAngle=function(e){return arguments.length?(l="function"==typeof e?e:t(+e),p):l},p.endAngle=function(e){return arguments.length?(s="function"==typeof e?e:t(+e),p):s},p.padAngle=function(e){return arguments.length?(o="function"==typeof e?e:t(+e),p):o},p}().value(t=>t.value);return l(r)},"createPieArcs"),F={parser:z,db:k,renderer:{draw:c((t,e,a,n)=>{u.debug("rendering pie chart\n"+t);const i=n.db,r=f(),l=g(i.getConfig(),r.pie),s=18,o=450,p=o,c=h(e),d=c.append("g");d.attr("transform","translate(225,225)");const{themeVariables:y}=r;let[w]=m(y.pieOuterStrokeWidth);w??(w=2);const b=l.textPosition,$=Math.min(p,o)/2-40,A=v().innerRadius(0).outerRadius($),D=v().innerRadius($*b).outerRadius($*b);d.append("circle").attr("cx",0).attr("cy",0).attr("r",$+w/2).attr("class","pieOuterCircle");const T=i.getSections(),C=O(T),j=[y.pie1,y.pie2,y.pie3,y.pie4,y.pie5,y.pie6,y.pie7,y.pie8,y.pie9,y.pie10,y.pie11,y.pie12];let k=0;T.forEach(t=>{k+=t});const M=C.filter(t=>"0"!==(t.data.value/k*100).toFixed(0)),z=S(j);d.selectAll("mySlices").data(M).enter().append("path").attr("d",A).attr("fill",t=>z(t.data.label)).attr("class","pieCircle"),d.selectAll("mySlices").data(M).enter().append("text").text(t=>(t.data.value/k*100).toFixed(0)+"%").attr("transform",t=>"translate("+D.centroid(t)+")").style("text-anchor","middle").attr("class","slice"),d.append("text").text(i.getDiagramTitle()).attr("x",0).attr("y",-200).attr("class","pieTitleText");const B=[...T.entries()].map(([t,e])=>({label:t,value:e})),F=d.selectAll(".legend").data(B).enter().append("g").attr("class","legend").attr("transform",(t,e)=>"translate(216,"+(22*e-22*B.length/2)+")");F.append("rect").attr("width",s).attr("height",s).style("fill",t=>z(t.label)).style("stroke",t=>z(t.label)),F.append("text").attr("x",22).attr("y",14).text(t=>i.getShowData()?`${t.label} [${t.value}]`:t.label);const R=512+Math.max(...F.selectAll("text").nodes().map(t=>(null==t?void 0:t.getBoundingClientRect().width)??0));c.attr("viewBox",`0 0 ${R} 450`),x(c,o,R,l.useMaxWidth)},"draw")},styles:B};export{F as diagram};
